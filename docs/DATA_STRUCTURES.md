# Core Data Structures

This document describes the core data structures used throughout the itingen system.

## Overview

Itingen uses two primary domain models:
- **Event**: Represents a single activity, appointment, or occurrence in a trip
- **Venue**: Represents a physical location where events can take place

Both models are implemented using Pydantic for validation and serialization.

---

## Event Model

The `Event` class represents a time-bound activity within a trip itinerary.

### Core Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `event_heading` | `str \| None` | No | Human-readable title of the event |
| `kind` | `str \| None` | No | Type/category of event (e.g., "flight", "lodging", "activity") |
| `location` | `str \| None` | No | Where the event takes place |
| `who` | `List[str]` | No | List of travelers participating in this event |
| `depends_on` | `List[str]` | No | Other events this event depends on |
| `venue_id` | `str \| None` | No | Reference to a Venue object |
| `timezone` | `str \| None` | No | Timezone identifier (e.g., "Pacific/Auckland") |
| `time_utc` | `str \| None` | No | Event time in UTC (ISO 8601 format) |
| `description` | `str \| None` | No | Detailed description of the event |
| `travel_to` | `str \| None` | No | Travel instructions to reach this event |

### Scheduling Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `coordination_point` | `bool \| None` | No | Marks events requiring traveler coordination |
| `hard_stop` | `bool \| None` | No | Events with strict timing that cannot be delayed |
| `inferred` | `bool \| None` | No | Events generated by the system vs explicitly defined |

### Extensibility

The Event model uses `extra="allow"` to capture additional fields from Markdown sources. This enables:
- Custom event types
- Trip-specific metadata
- Future schema extensions without breaking changes

### Example

```python
event = Event(
    event_heading="Airport Arrival",
    kind="flight",
    location="AKL Airport",
    who=["Alice", "Bob"],
    time_utc="2025-12-29T10:30:00Z",
    timezone="Pacific/Auckland",
    coordination_point=True,
    description="Arrive at Auckland airport and clear customs"
)
```

---

## Venue Model

The `Venue` class represents a physical location with rich metadata for AI generation and trip planning.

### Core Identity

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `venue_id` | `str` | Yes | Unique identifier (pattern: `^[a-z0-9\-]+$`) |
| `canonical_name` | `str` | Yes | Official name of the venue |
| `aliases` | `List[str]` | No | Alternative names or spellings |

### Metadata

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `metadata` | `VenueMetadata` | Yes | Creation and update timestamps |

### Contact Information

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `contact` | `VenueContact \| None` | No | Phone, email, website |
| `address` | `str \| VenueAddress \| None` | No | Physical location (string or structured) |
| `booking` | `VenueBooking \| None` | No | Reservation details and requirements |

### AI Enhancement Fields

These fields support AI-generated content:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `primary_cues` | `List[str]` | No | Key visual elements for image generation |
| `secondary_cues` | `List[str]` | No | Supporting visual elements |
| `camera_suggestions` | `List[str]` | No | Photography tips and angles |
| `negative_cues` | `List[str]` | No | Elements to avoid in images |
| `reference_image_urls` | `List[str]` | No | Example images for style reference |
| `sources` | `List[str]` | No | Source URLs for research/verification |

### Supporting Models

#### VenueMetadata
```python
class VenueMetadata(BaseModel):
    created_at: str  # ISO 8601 timestamp
    updated_at: str  # ISO 8601 timestamp
```

#### VenueContact
```python
class VenueContact(BaseModel):
    phone: Optional[str] = None
    email: Optional[str] = None
    website: Optional[str] = None
```

#### VenueAddress
```python
class VenueAddress(BaseModel):
    street: Optional[str] = None
    city: Optional[str] = None
    region: Optional[str] = None
    country: Optional[str] = None
    postcode: Optional[str] = None
```

#### VenueBooking
```python
class VenueBooking(BaseModel):
    reference: Optional[str] = None  # Booking confirmation number
    requirements: Optional[str] = None  # Special requirements
    phone: Optional[str] = None  # Booking contact phone
    website: Optional[str] = None  # Booking website
```

### Example

```python
venue = Venue(
    venue_id="grand-hotel-auckland",
    canonical_name="Grand Hotel Auckland",
    aliases=["Grand Auckland", "Auckland Grand"],
    metadata=VenueMetadata(
        created_at="2025-12-29T12:00:00Z",
        updated_at="2025-12-29T12:00:00Z"
    ),
    contact=VenueContact(
        phone="+64 9 123 4567",
        website="https://grandhotel.auckland"
    ),
    address=VenueAddress(
        street="123 Queen St",
        city="Auckland",
        country="New Zealand"
    ),
    primary_cues=["luxury lobby", "marble floors", "chandelier"],
    camera_suggestions=["wide angle for lobby", "detail shots of architecture"]
)
```

---

## Data Flow

1. **Ingestion**: Events are parsed from Markdown files, Venues from JSON
2. **Enrichment**: Events linked to Venues via `venue_id`
3. **Hydration**: External data added (maps, weather, AI content)
4. **Emission**: Final data rendered to output formats

## Design Principles

1. **Explicit over Implicit**: All fields are clearly typed and documented
2. **Extensible**: Both models support additional fields via `extra="allow"`
3. **Validated**: Pydantic ensures data integrity throughout the pipeline
4. **Serializable**: Models can be easily converted to/from JSON
5. **Type-safe**: Full type hints for IDE support and static analysis

## Best Practices

1. **Event-Kinds**: Use consistent, lowercase event kinds (e.g., "flight", "lodging")
2. **Venue IDs**: Use lowercase with hyphens, no spaces or special characters
3. **Timestamps**: Always use ISO 8601 format for time fields
4. **Lists**: Default to empty lists rather than `None` for array fields
5. **Extensions**: Use additional fields sparingly and document them well

## Migration from Original Schema

The original scaffold project used dictionaries for these structures. The migration to Pydantic models provides:
- Type validation
- Better IDE support
- Automatic serialization/deserialization
- Clear field documentation
- Runtime error checking
